#!/usr/bin/env bash

# kubectl-setns - Kubernetes plugin for setting the current namespace
#
# Usage: kubectl setns <namespace>
# If no namespace is provided, the default namespace will be used.

set -euo pipefail

source "$HOME/.config/utils/common.sh"

# display usage information
function usage() {
    echo "Usage: kubectl setns <namespace>"
    echo "If no namespace is provided, the 'default' namespace will be used."
    exit 1
}

# Check if kubectl is installed
if ! command -v kubectl &>/dev/null; then
    log_error "kubectl is not installed or not in PATH"
    exit 1
fi

# Parse the namespace argument
NAMESPACE=${1:-default}

# Validate namespace input (optional step to check valid characters)
if [[ ! "$NAMESPACE" =~ ^[a-zA-Z0-9-]+$ ]]; then
    log_error "Invalid namespace name. Namespaces must only contain alphanumeric characters and hyphens."
    usage
fi

# Set the current namespace in the kubeconfig
log_info "Setting current namespace to '$NAMESPACE'"
if kubectl config set-context --current --namespace="$NAMESPACE"; then
    log_info "Namespace successfully set to '$NAMESPACE'"
else
    log_error "Failed to set namespace to '$NAMESPACE'"
    exit 1
fi
