#!/usr/bin/env bash

# kubectl-dorker - Kubernetes wrapper for creating a pod with debugging tools

YAML_FILE="$HOME/.config/utils/kubernetes.yaml"

# Check if the YAML file exists
if [ ! -f "$YAML_FILE" ]; then
    echo "Error: Kubernetes configuration file $YAML_FILE does not exist."
    exit 1
fi


function usage() {
    echo "Usage: kubectl dorker {up|down}"
    exit 1
}

function up() {
    echo "Applying dorker configuration..."
    kubectl apply -f "$YAML_FILE"

    # Wait for the pod to be ready
    echo "Waiting for the dorker pod to be ready..."
    kubectl wait --for=condition=ready pod/dorker --timeout=120s

    # Open a shell inside the 'dorker' container
    echo "Opening shell in dorker container..."
    kubectl exec -it dorker --container dorker -- /bin/bash
}

function down() {
    echo "Deleting all resources deployed by dorker..."
    kubectl delete -f "$YAML_FILE"
}

if [ "$1" == "up" ]; then
    up
elif [ "$1" == "down" ]; then
    down
else
    usage
fi
